# 定投管理工具使用说明

## 快速开始

### 1. 启动应用

```bash
python -m venv venv
source venv/bin/activate
python main.py
```

应用将在 `http://localhost:5006` 启动。

### 2. 注册账户

1. 访问 `http://localhost:5006/auth/register`
2. 填写用户名、邮箱和密码
3. 点击"注册"按钮

### 3. 登录系统

1. 访问 `http://localhost:5006/auth/login`
2. 使用用户名/邮箱和密码登录

## 功能使用指南

### 用户管理

#### 个人设置
- 访问"个人设置"页面
- 可以修改用户名、邮箱
- 配置企业微信群机器人webhook URL
- 修改登录密码

### 定投提醒管理

#### 创建定投提醒
1. 点击"定投提醒"菜单
2. 点击"创建提醒"按钮
3. 填写以下信息：
   - **股票代码**: 如 000001, AAPL, 00700
   - **定投金额**: 每次定投的金额
   - **定投频率**: 选择按月或按周
   - **具体时间**: 选择具体日期或星期

#### 管理定投提醒
- 查看所有提醒列表
- 编辑提醒设置
- 启用/禁用提醒
- 删除提醒

### 定投记录管理

#### 添加定投记录
1. 点击"定投记录"菜单
2. 点击"添加记录"按钮
3. 填写以下信息：
   - **股票代码**: 交易的股票代码
   - **买入日期**: 交易执行日期
   - **买入金额**: 本次定投金额
   - **买入数量**: 实际买入的股数
   - **买入价格**: 成交均价
   - **手续费**: 交易费用（可选）
   - **备注**: 交易备注信息

#### 管理定投记录
- 查看所有记录列表
- 按股票代码筛选
- 按时间范围筛选
- 编辑历史记录
- 删除记录

### 成本分析

#### 查看成本分析
1. 点击"成本分析"菜单
2. 查看以下信息：
   - **总投入金额**: 所有定投金额的累计
   - **总手续费**: 所有交易费用的累计
   - **总交易次数**: 定投执行次数统计
   - **按股票分组**: 每个股票的成本详情
   - **平均成本价**: 总投入金额 ÷ 总持股数量

#### 成本详情
- 点击"查看详情"按钮查看具体交易记录
- 包含每次交易的详细信息

### 收益分析

#### 查看收益分析
1. 点击"收益分析"菜单
2. 查看以下信息：
   - **总成本**: 所有投入成本
   - **当前市值**: 按当前价格计算的持仓价值
   - **盈亏金额**: 当前市值 - 总成本
   - **收益率**: 盈亏金额 ÷ 总成本 × 100%

#### 更新股票价格
- 在收益分析页面手动输入当前价格
- 系统自动计算盈亏情况
- 支持按股票代码分组显示

## 测试验证

### 功能测试结果

✅ **用户管理功能**
- 用户注册：成功
- 用户登录：成功
- 密码验证：成功
- 个人设置：成功

✅ **定投提醒功能**
- 创建提醒：成功
- 提醒管理：成功
- 频率设置：支持按月/按周
- 状态切换：成功

✅ **定投记录功能**
- 添加记录：成功
- 记录管理：成功
- 数据筛选：成功
- 记录编辑：成功

✅ **成本分析功能**
- 成本计算：成功
- 平均成本：正确计算
- 分组统计：成功
- 详情查看：成功

✅ **收益分析功能**
- 收益计算：成功
- 盈亏分析：正确计算
- 收益率计算：正确
- 价格更新：成功

### 数据库测试

✅ **数据模型**
- User模型：正常
- InvestmentReminder模型：正常
- InvestmentRecord模型：正常

✅ **数据操作**
- 数据插入：成功
- 数据查询：成功
- 数据更新：成功
- 数据删除：成功

### Web界面测试

✅ **页面访问**
- 登录页面：200 OK
- 注册页面：200 OK
- 仪表板：302 重定向（未登录）
- 定投提醒：302 重定向（未登录）
- 定投记录：302 重定向（未登录）
- 成本分析：302 重定向（未登录）
- 收益分析：302 重定向（未登录）

✅ **权限控制**
- 未登录用户正确重定向到登录页面
- 登录验证正常工作

## 技术特性

### 安全特性
- 密码加密存储
- 会话管理
- 登录验证装饰器
- SQL注入防护

### 数据精度
- 使用Decimal类型处理金额
- 支持4位小数精度
- 避免浮点数精度问题

### 用户体验
- 响应式Bootstrap界面
- 友好的错误提示
- 直观的操作流程
- 数据验证

### 扩展性
- 模块化设计
- 蓝图架构
- 易于添加新功能
- 数据库迁移支持

## 注意事项

1. **数据安全**: 所有数据存储在本地SQLite数据库中
2. **价格更新**: 股票价格需要手动输入，暂不集成实时行情API
3. **Webhook配置**: 企业微信webhook需要用户自行配置群机器人
4. **浏览器兼容**: 建议使用现代浏览器（Chrome、Firefox、Safari、Edge）

## 后续扩展

- 集成股票行情API获取实时价格
- 添加更多技术指标分析
- 支持多币种投资
- 移动端适配
- 数据导出功能
- 投资策略回测
